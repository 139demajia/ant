import "@ant.objcontroller"
import "@ant.math"
import "@ant.general"

system "scenespace_system"
    .implement "scenespace.lua"
    .require_interface "ant.objcontroller|obj_motion"
    .require_interface "ant.objcontroller|camera_motion"
    .method "update_hierarchy_scene"

policy "hierarchy_policy"
    .require_system "scenespace_system"
    .require_transform "ant.general|rendercache_transform"
    .component "scene_entity"
    .action "mount"

action "mount"
    .implement "scenespace.lua"
    .method "init"

transform "generate_transform"
    .implement "transform.lua"
    .require_transform "ant.general|rendercache_transform"
    .input "transform"
    .output "_rendercache.transform"
    .method "process_entity"

policy "transform_policy"
    .require_transform "generate_transform"
    .component "transform"
    .component "scene_entity"

policy "lock_traget_policy"
    .require_transform "generate_transform"
    .require_system "ant.scene|filter_system"
    .component "lock_target"
    .component "parent"
    .component "scene_entity"
    .component "transform"

component "primitive_filter"
    .implement "scenespace.lua"
    .method "init"

interface "iscenespace"
    .implement "scenespace.lua"
    .method "scenequeue"

import "filter/filter_system.ecs"
pipeline "scene"
    .stage "update_hierarchy_scene"
    .stage "filter_render_items"

interface "itransform"
    .implement "transform.lua"
    .method "worldmat"
    .method "srt"
    .method "set"
    .method "set_srt"